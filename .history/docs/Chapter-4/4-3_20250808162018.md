## 4.3 截断策略迭代

接下来，我们介绍一种更通用的算法，称为截断策略迭代。我们会看到，值迭代算法和策略迭代算法是截断策略迭代算法的两种特殊情况。

### 4.3.1 比较值迭代与策略迭代

首先，我们通过列出以下步骤来比较值迭代和策略迭代算法。

- 策略迭代：选择任意一个的初始策略 $\pi_0$。在第$k$次迭代中，执行以下两个步骤。
    - 步骤 1：策略评估(PE)。给定$\pi_k$，求解$v_{\pi_k}$，满足
        $$v_{\pi_k}=r_{\pi_k}+\gamma P_{\pi_k}v_{\pi_k}.$$
    - 步骤 2：策略改进(PI)。给定$v_{\pi_k}$，从以下公式求解$\pi_{k+1}$：
        $$\pi_{k+1}=\arg\max_\pi(r_\pi+\gamma P_\pi v_{\pi_k}).$$

- 值迭代：选择任意一个的初始值$v_0$。在第$k$次迭代中，执行以下两个步骤。
    - 步骤 1：策略更新(PU)。给定$v_k$，从以下公式求解$\pi_{k+1}$：
        $$\pi_{k+1}=\arg\max_\pi(r_\pi+\gamma P_\pi v_{\pi_k}).$$
    - 步骤2: 值更新(VU)。给定$\pi_{k+1}$，从以下式子中求解$v_{k+1}$：
        $$v_{k+1}=r_{\pi_{k+1}}+\gamma P_{\pi_{k+1}}v_{k}.$$

上述两个算法的步骤可以表示为:

$$\begin{aligned}\text{Policy iteration:} \quad \pi_0 \xrightarrow{\text{PE}} &v_{\pi_0} \xrightarrow{\text{PI}} \pi_1 \xrightarrow{\text{PE}} v_{\pi_1} \xrightarrow{\text{PI}} \pi_2 \xrightarrow{\text{PE}} v_{\pi_2} \xrightarrow{\text{PI}} \cdots\\\text{Value iteration:} \quad &v_0 \xrightarrow{\text{PU}} \pi_1^\prime \xrightarrow{\text{VU}} v_1 \xrightarrow{\text{PU}} \pi_2^\prime \xrightarrow{\text{VU}} v_2 \xrightarrow{\text{PU}} \cdots\end{aligned}$$

可以看出，这两种算法的步骤非常相似。

我们更仔细地考察它们的价值步骤，以了解这两种算法之间的差异。特别地，让两种算法都从相同的初始条件开始：$v_0 = v_{\pi_0}$。两种算法的步骤列于表$4.6$中。在最初的三个步骤中，由于$v_0=v_{\pi_0}$，两种算法生成了相同的结果。它们在第四步变得有所不同。在第四步中，值迭代算法执行$v_1=r_{\pi_1}+\gamma P_{\pi_1}v_0,$，这是一个一步计算；而策略迭代算法求解$v_{\pi_{1}}=r_{\pi_{1}}+\gamma P_{\pi_{1}}v_{\pi_{1}},$，则需要进行无限次迭代。如果我们显式写出第四步中求解$v_{\pi_1}=r_{\pi_1}+\gamma P_{\pi_1}v_{\pi_1}$的迭代过程，一切就会变得清晰。通过令$v_{\pi_1}^{(0)}=v_0$，我们有

$$\text{value iteration}\leftarrow v_{1} \leftarrow \begin{aligned}v_{\pi_{1}}^{(0)} &= v_{0} \\v_{\pi_{1}}^{(1)} &= r_{\pi_{1}} + \gamma P_{\pi_{1}} v_{\pi_{1}}^{(0)} \\v_{\pi_{1}}^{(2)} &= r_{\pi_{1}} + \gamma P_{\pi_{1}} v_{\pi_{1}}^{(1)} \\\vdots\end{aligned}
$$
$$
$\text{truncated policy iteration}$ $\leftarrow$ $\bar{v}_{1}$ $\leftarrow$ $v_{\pi_{1}}^{(j)} = r_{\pi_{1}} + \gamma P_{\pi_{1}} v_{\pi_{1}}^{(j-1)}$
$$
policy iteration $\leftarrow$ $v_{\pi_{1}}$ $\leftarrow$ $v_{\pi_{1}}^{(\infty)} = r_{\pi_{1}} + \gamma P_{\pi_{1}} v_{\pi_{1}}^{(\infty)}$