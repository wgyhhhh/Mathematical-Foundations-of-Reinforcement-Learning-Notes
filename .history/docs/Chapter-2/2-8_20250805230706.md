## 2.8从状态值到行动值

在本章中，我们已经讨论了状态值，现在我们转向行动值，它表示在一个状态下采取动作的“价值”。虽然行动值的概念很重要，但之所以在本章最后一节引入它，是因为它在很大程度上依赖于状态价值的概念，在研究行动值之前首先理解状态值是很重要的。

状态-行动对$(s,a)$的行动值定义为：

$$q_\pi(s,a)\doteq\mathbb{E}[G_t|S_t=s,A_t=a].$$

可以看出，行动值被定义为在一个状态下采取动作后可以获得的预期回报。必须注意的是，$q_\pi(s,a)$依赖于状态-行动对$(s,a)$，而不是单独的动作。将此值称为状态-行动值可能更严格，但为了简单起见，通常将其称为行动值。

行动值和状态值之间的关系是什么?

1. 首先，从条件期望的性质可以得出，

    $$\underbrace{\mathbb{E}[G_t|S_t=s]}_{v_\pi(s)}=\sum_{a\in\mathcal{A}}\underbrace{\mathbb{E}[G_t|S_t=s,A_t=a]}_{q_\pi(s,a)}\pi(a|s).$$

    因此有，

    $$v_\pi(s)=\sum_{a\in\mathcal{A}}\pi(a|s)q_\pi(s,a).\tag{2.13}$$

    因此，状态值是与该状态相关联的行动值的期望。

2. 其次，由于状态值由下式给出：

    $$v_{\pi}(s)=\sum_{a\in\mathcal{A}}\pi(a|s)\left[\sum_{r\in\mathcal{R}}p(r|s,a)r+\gamma\sum_{s^{\prime}\in\mathcal{S}}p(s^{\prime}|s,a)v_{\pi}(s^{\prime})\right],$$

    与公式$(2.13)$相比,

    $$\begin{aligned}q_\pi(s,a)=\sum_{r\in\mathcal{R}}p(r|s,a)r+\gamma\sum_{s^{\prime}\in\mathcal{S}}p(s^{\prime}|s,a)v_\pi(s^{\prime}).\end{aligned}\tag{2.14}$$