## 2.7根据贝尔曼方程求解状态值

计算给定策略的状态值是强化学习中的一个基本问题。这个问题通常被称为 "策略评估"。在本节中，我们将介绍从贝尔曼方程计算状态值的两种方法。

### 2.7.1 封闭式解决方案

由于$v_{\pi}=r_{\pi}+\gamma P_{\pi}v_{\pi}$是一个简单的线性方程，因此很容易求出其封闭方程的解，即

$$v_{\pi}=(I-\gamma P_{\pi})^{-1}r_{\pi}.$$

下面给出了$(I-\gamma P_{\pi})^{-1}$的一些特性。

- $I-\gamma P_{\pi}$是可逆的。证明如下，根据格什高林圆定理[4]，$I-\gamma P_{\pi}$的每个特征值都位于至少一个格什高林圆内。第$i$个格什高林圆的圆心位于$[I-\gamma P_{\pi}]_{ii}=1-\gamma p_{\pi}(s_{i}|s_{i})$，半径等于$\sum_{j\neq i}[I-\gamma P_{\pi}]_{ij}=-\sum_{j\neq i}\gamma p_{\pi}(s_{j}|s_{i}).$。由于$\gamma<1$，我们知道半径小于中心大小: $\sum_{j\neq i}\gamma p_{\pi}(s_{j}|s_{i})<1-\gamma p_{\pi}(s_{i}|s_{i}).$。因此，所有格什高林圆都不环绕原点，因此$I-\gamma P_{\pi}$的任何特征值都不为零。

- $(I-\gamma P_{\pi})^{-1} \geq I$，这意味着$(I - \gamma P_\pi)$的每个元素都是非负的，而且更具体地说，不小于单位矩阵的元素。这是因为$P_\pi$具有非负数项,因此$(I-\gamma P_{\pi})^{-1}=I+\gamma P_{\pi}+\gamma^{2}P_{\pi}^{2}+\cdots\geq I\geq0$。

- 对于任何矢量$r\geq 0$，都认为$(I-\gamma P_{\pi})^{-1}r\geq r \geq 0$。这一性质源于因为$[(I-\gamma P_{\pi})^{-1}-I]r\geq0$。因此，如果$r_1\geq r_2$，我们有$(I-\gamma P_\pi)^{-1}r_1\geq(I-\gamma P_\pi)^{-1}r_2$。

### 2.7.2 迭代解

尽管封闭式解法有助于理论分析，但在实践中并不适用，因为它涉及矩阵反演运算，而这一运算仍需要通过其他数值算法来计算。
计算。事实上，我们可以用下面的迭代算法直接求解贝尔曼方程

$$v_{k+1}=r_{\pi}+\gamma P_{\pi}v_{k},\quad k=0,1,2,\ldots,\tag{2.11}$$

该算法生成一串值${v_0,v_1,v_2,\cdots}$，其中$v_0\in \mathbb{R}^n$是对$v_\pi$的初始猜测。条件是

$$v_{k}\to v_{\pi}=(I-\gamma P_{\pi})^{-1}r_{\pi},\quad\mathrm{as}k\to\infty.\tag{2.12}$$

感兴趣的读者可以看下列证明

!!! note 证明
    将误差定义为$\delta_k = v_k - v_\pi$。我们只需证明$\delta_k \rightarrow 0$。$v_{k+1} = \delta_{k+1} + v_\pi$ 和 $v_k = \delta_k + v_\pi$ 代入 $v_{k+1} = r_\pi + \gamma P_\pi v_k$ 可得